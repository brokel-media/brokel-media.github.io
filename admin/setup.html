<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Admin Access</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; line-height: 1.5; }
        input, button { width: 100%; padding: 0.5rem; margin-bottom: 1rem; box-sizing: border-box; }
        button { background: #333; color: white; border: none; cursor: pointer; }
        button:hover { background: #555; }
        code { background: #f4f4f4; padding: 1rem; display: block; word-break: break-all; }
    </style>
</head>
<body>
    <h1>Setup Admin Access</h1>
    <p>Use this tool to generate the secure configuration for your blog.</p>
    
    <label>
        <strong>1. GitHub Personal Access Token</strong>
        <small style="display:block; color: #666; margin-bottom: 0.5rem;">Create a "Fine-grained token" with "Contents: Read and Write" permission for this repository.</small>
        <input type="password" id="token" placeholder="github_pat_..." />
    </label>

    <label>
        <strong>2. Choose a Password for Friends</strong>
        <input type="text" id="password" placeholder="MySecretPassword123" />
    </label>

    <button onclick="generateConfig()">Generate Configuration</button>

    <div id="result" style="display:none; margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
        <h3>Success!</h3>
        <p>Copy the code below and paste it into <code>admin/config.js</code>:</p>
        <code id="output"></code>
    </div>

    <script>
        async function generateConfig() {
            const token = document.getElementById('token').value;
            const password = document.getElementById('password').value;
            
            if (!token || !password) {
                alert('Please fill in both fields');
                return;
            }

            const enc = new TextEncoder();
            const keyMaterial = await window.crypto.subtle.importKey(
                "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
            );

            const salt = window.crypto.getRandomValues(new Uint8Array(16));
            const key = await window.crypto.subtle.deriveKey(
                { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
                keyMaterial, { name: "AES-GCM", length: 256 }, true, ["encrypt"]
            );

            const iv = window.crypto.getRandomValues(new Uint8Array(12));
            const encrypted = await window.crypto.subtle.encrypt(
                { name: "AES-GCM", iv: iv },
                key,
                enc.encode(token)
            );

            const config = {
                salt: Array.from(salt),
                iv: Array.from(iv),
                data: Array.from(new Uint8Array(encrypted))
            };

            const fileContent = `// This file is auto-generated. Do not edit manually.\nexport const config = ${JSON.stringify(config, null, 2)};`;
            
            document.getElementById('output').innerText = fileContent;
            document.getElementById('result').style.display = 'block';
        }
    </script>
</body>
</html>